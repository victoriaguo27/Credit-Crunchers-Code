---
title: "HMDA Analysis"
output: pdf_document
date: "2024-02-19"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load Packages
```{r}
library(ggplot2)
library(dplyr)
library(rvest)
```

# Data Prep
```{r}
# Load in HMDA Data
HMDA<-read.csv("/Users/herminiocervantes/Documents/Spring 24/STAT 4996 Capstone/final_data_HMDA.csv")

# Create unemployment rates column
unemployment_rates <- data.frame(
  state_abbr = c(rep('VA', 6), rep('CA', 6)),
  as_of_year = rep(2007:2012, 2),
  unemployment_rate = c(3.0, 3.9, 6.7, 6.9, 6.4, 5.9, 5.4, 7.2, 11.3, 12.4, 11.8, 10.4)
)

# Join the unemployment rates with the HMDA data
HMDA <- merge(HMDA, unemployment_rates, by = c("state_abbr", "as_of_year"), all.x = TRUE)

```

# Question 1 Data Prep and Analysis
## Are black female applicants less likely to be approved for a home mortgage during recession than recovery as compared to white female applicants? 
```{r}
# Step 1: Filter the data for female applicants and create the Recession/Recovery variable
HMDA_female <- HMDA %>%
  filter(applicant_sex_name == "Female" & 
         applicant_race_name_1 %in% c("Black or African American", "White")) %>%
  mutate(approval = ifelse(action_taken_name == "Loan originated", 1, 0))

# Step 2: Exploratory Data Analysis
# Calculate approval rates by race and period
approval_rates <- HMDA_female %>%
  group_by(applicant_race_name_1, period) %>%
  summarize(ApprovalRate = mean(approval, na.rm = TRUE), .groups = 'drop') 

print(approval_rates)
```

```{r}
# Step 3: Logistic Regression
# Fit a logistic regression model based on interaction between race and period
model <- glm(approval ~ applicant_race_name_1 * period, data = HMDA_female, family = binomial)

# Step 4: Hypothesis Testing
# Get a summary of the model to check p-values
summary(model)
```

- The reference group here seems to be Black applicants during the Reecession period. The negative coefficient suggests that the log-odds of approval for this group are lower compared to the base level set by the model (often this is the group with the highest approval rate).
- The positive coefficient for applicant_race_name_1White indicates that white applicants have higher log-odds of approval compared to the reference group.
- The positive coefficient for periodRecovery suggests that the log-odds of approval are higher during the Recovery period compared to the Recession period.
- The coefficient for the interaction term represents the difference in the effect of the economic period on the log-odds of approval for white applicants compared to the reference group. The fact that this coefficient is not statistically significant (p-value = 0.527) suggests that the difference in loan approval rates between the Recession and Recovery periods does not significantly differ for white applicants compared to non-white applicants.

Overall, this model suggests that both race and economic period are significant predictors of loan approval on their own, but the interaction between race and economic period does not significantly affect the approval rate. This means that the difference in approval rates between white and non-white applicants appears to be consistent across both the Recession and Recovery periods.



