---
title: "HMDA Analysis"
output: pdf_document
date: "2024-02-19"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load Packages
```{r}
library(ggplot2)
library(dplyr)
library(rvest)
```

# Data Prep
```{r}
# Load in HMDA Data
HMDA<-read.csv("final_data_HMDA.csv")

# Create unemployment rates column
unemployment_rates <- data.frame(
  state_abbr = c(rep('VA', 6), rep('CA', 6)),
  as_of_year = rep(2007:2012, 2),
  unemployment_rate = c(3.0, 3.9, 6.7, 6.9, 6.4, 5.9, 5.4, 7.2, 11.3, 12.4, 11.8, 10.4)
)

# Join the unemployment rates with the HMDA data
HMDA <- merge(HMDA, unemployment_rates, by = c("state_abbr", "as_of_year"), all.x = TRUE)

```

# Question 1 Data Prep and Analysis
## Are White female applicants more likely to be approved for a home mortgage compared to the Black female applicants during the recovery period, while controlling for other relevant variables?
```{r}
# Step 1: Filter the data for female applicants and create the Recession/Recovery variable
HMDA_female_Recovery <- HMDA %>%
  filter(period == "Recovery" & applicant_sex_name == "Female" & 
         applicant_race_name_1 %in% c("Black or African American", "White")) %>%
  mutate(approval = ifelse(action_taken_name == "Loan originated", 1, 0))

# Step 2: Exploratory Data Analysis
# Calculate approval rates by race and period
approval_rates <- HMDA_female_Recovery %>%
  group_by(applicant_race_name_1, period) %>%
  summarize(ApprovalRate = mean(approval, na.rm = TRUE), .groups = 'drop') 

print(approval_rates)
```

```{r}
# Step 3: Logistic Regression
# Fit a logistic regression model based on interaction between race and period
model <- glm(approval ~ applicant_race_name_1 + as_of_year + agency_abbr +
               + loan_type_name + loan_purpose_name + loan_amount_000s + preapproval_name + hud_median_family_income + unemployment_rate + state_abbr, data = HMDA_female_Recovery, family = binomial)

# Step 4: Hypothesis Testing
# Get a summary of the model to check p-values
summary(model)
```
exp(0.8832) = 2.418627


Now, you can interpret this result:

The odds of mortgage approval for White female applicants during the recovery period are approximately 2.419 times higher than the odds for the reference group of Black applicants after accounting for other variables in the model. This effect is statistically significant, as indicated by the associated p-value.


## Are White female applicants more likely to be approved for a home mortgage compared to the Black female applicants during the recession period, while controlling for other relevant variables?

```{r}
# Step 1: Filter the data for female applicants and create the Recession/Recovery variable
HMDA_female_Recession <- HMDA %>%
  filter(period == "Recession" & applicant_sex_name == "Female" & 
         applicant_race_name_1 %in% c("Black or African American", "White")) %>%
  mutate(approval = ifelse(action_taken_name == "Loan originated", 1, 0))

# Step 2: Exploratory Data Analysis
# Calculate approval rates by race and period
approval_rates <- HMDA_female_Recession %>%
  group_by(applicant_race_name_1, period) %>%
  summarize(ApprovalRate = mean(approval, na.rm = TRUE), .groups = 'drop') 

print(approval_rates)

# Step 3: Logistic Regression
# Fit a logistic regression model based on interaction between race and period
model2 <- glm(approval ~ applicant_race_name_1 + as_of_year + agency_abbr +
               + loan_type_name + loan_purpose_name + loan_amount_000s + preapproval_name + hud_median_family_income + unemployment_rate + state_abbr, data = HMDA_female_Recession, family = binomial)

# Step 4: Hypothesis Testing
# Get a summary of the model to check p-values
summary(model2)
```
exp(0.6787) = 1.971313


The odds of mortgage approval for White female applicants during the recession period are approximately 1.971 times higher than the odds for the reference group of Black applicants after accounting for other variables in the model. This effect is statistically significant, as indicated by the associated p-value.





